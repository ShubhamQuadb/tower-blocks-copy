<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="screen-orientation" content="landscape">
    <meta name="x5-orientation" content="landscape">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-navbutton-color" content="#000000">
    <meta name="apple-mobile-web-app-title" content="Tower Blocks">
    <meta name="application-name" content="Tower Blocks">
<script src="https://codepen.io/steveg3003/pen/zBVakw"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r83/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
    <title>Tower Blocks</title>
    
    
    <link rel="stylesheet" href="style.css?v=22" />
    <style>
        /* Force everything to landscape - hide all content in portrait */
        @media screen and (orientation: portrait) {
            body {
                overflow: hidden;
            }
            
            #loadingScreen,
            #container,
            footer {
                display: none !important;
            }
            
            body::before {
                content: "üîÑ";
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 100px;
                z-index: 9999;
            }
            
            body::after {
                content: "";
                display: none;
            }
            
            #rotate-text {
                position: fixed;
                top: 60%;
                left: 50%;
                transform: translateX(-50%);
                color: #fff;
                font-size: 20px;
                text-align: center;
                width: 80%;
                z-index: 9999;
                font-family: 'Comfortaa', cursive;
                font-weight: 600;
                display: block !important;
                background: rgba(0, 0, 0, 0.7);
                padding: 10px 20px;
                border-radius: 10px;
                border: 2px solid #fff;
            }
            
        }
        
        /* Hide rotate text in landscape mode */
        @media screen and (orientation: landscape) {
            #rotate-text {
                display: none !important;
            }
        }
        
        /* Fullscreen and landscape mode optimizations */
        html, body {
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            position: fixed;
            top: 0;
            left: 0;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1; /* Below home screen */
        }
        
        /* Hide container content initially - home screen will be on top */
        #container:not(.game-started) {
            pointer-events: none; /* Disable interactions when home screen is showing */
        }
        
        #container.game-started {
            pointer-events: auto; /* Enable interactions when game starts */
        }
        
        #game {
            width: 100%;
            height: 100%;
            position: absolute;
            inset: 0;
            z-index: 0; /* keep game layer below instructions background */
        }

        /* Instructions background layer */
        #instructions-bg {
            position: absolute;
            inset: 0;
            background: url('tower block background img.jpg') center/cover no-repeat;
            z-index: 1; /* above game, below instructions UI */
            display: none; /* shown only on instructions */
        }

        .game-ready { 
            position: relative; 
            z-index: 2; 
            display: none !important; /* Hide initially - will show when game starts */
        }
        
        /* Game elements are behind home screen - no need to hide them */
        
        /* Landscape mode optimizations for all smartphones */
        @media screen and (orientation: landscape) {
            html, body {
                width: 100vw;
                height: 100vh;
                height: 100dvh;
                position: fixed;
                overflow: hidden;
            }
            
            #container {
                width: 100vw;
                height: 100vh;
                height: 100dvh;
                padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            }
            
            #game {
                width: 100%;
                height: 100%;
            }
        }
        
        /* Specific fixes for high-resolution devices (Samsung S24, etc.) */
        @media screen and (orientation: landscape) and (min-width: 800px) {
            #score {
                font-size: clamp(3rem, 8vw, 5rem) !important;
            }
            
            #instructions {
                font-size: clamp(1.2rem, 3vw, 1.8rem) !important;
            }
            
            .game-ready h3, .game-over h2 {
                font-size: clamp(2rem, 5vw, 3rem) !important;
            }
            
            .game-ready p, .game-over p {
                font-size: clamp(1rem, 2.5vw, 1.4rem) !important;
            }
            
            #start-button {
                font-size: clamp(1.5rem, 4vw, 2.2rem) !important;
                padding: clamp(15px, 2.5vh, 25px) clamp(40px, 6vw, 60px) !important;
            }
        }
        
        /* Loading Screen Styles */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #1a0b2e 0%, #16213e 50%, #0f3460 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10001; /* Above home screen to show splash first */
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        #loadingScreen.loaded {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        /* Home Screen Styles */
        #homeScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: url('tower block background img.jpg') center/cover no-repeat;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000 !important; /* Above everything including container */
            visibility: visible !important;
        }
        
        #homeScreen.show {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 10000 !important;
        }
        
        /* Hide home screen when game starts */
        #homeScreen:not(.show) {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            z-index: -1 !important;
            pointer-events: none !important;
        }
        
        /* Ensure home screen shows after loading - override any other styles */
        body:not(.game-playing) #homeScreen.show {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 10000 !important;
            pointer-events: auto !important;
        }
        
        .home-content {
            text-align: center;
            background: rgba(6, 12, 20, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: clamp(30px, 5vh, 50px) clamp(20px, 5vw, 40px);
            border: 2px solid rgba(255, 20, 147, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            max-width: 90%;
            animation: fadeInHome 0.5s ease;
        }
        
        @keyframes fadeInHome {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .home-title {
            font-size: clamp(2rem, 8vw, 3.5rem);
            font-weight: 900;
            color: #FF1493;
            text-shadow: 0 0 30px rgba(255, 20, 147, 0.8);
            margin-bottom: clamp(8px, 1.5vh, 15px);
            letter-spacing: 1px;
        }
        
        .home-subtitle {
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            color: #fff;
            margin-bottom: clamp(20px, 3vh, 30px);
            opacity: 0.9;
        }
        
        .home-buttons {
            display: flex;
            flex-direction: column;
            gap: clamp(12px, 2vh, 16px);
            width: 100%;
            max-width: 250px;
            margin: 0 auto;
        }
        
        .home-btn {
            padding: clamp(12px, 2.5vh, 16px) clamp(25px, 5vw, 35px);
            font-size: clamp(1rem, 3vw, 1.4rem);
            font-weight: 700;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            letter-spacing: 0.5px;
            pointer-events: auto !important;
            z-index: 10001 !important;
            position: relative;
        }
        
        .home-btn-start {
            background: linear-gradient(135deg, #FF1493, #FF69B4);
            color: #fff;
        }
        
        .home-btn-start:active {
            transform: scale(0.95);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .home-btn-help {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .home-btn-help:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Help Modal Styles */
        #helpModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10001;
        }
        
        #helpModal.show {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            z-index: 10001 !important;
        }
        
        /* Hide help modal when not showing */
        #helpModal:not(.show) {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }
        
        .help-content {
            background: linear-gradient(135deg, #1a0b2e 0%, #16213e 50%, #0f3460 100%);
            border-radius: 20px;
            padding: clamp(18px, 2.5vh, 22px) clamp(16px, 3.5vw, 22px);
            max-width: 85%;
            max-height: 85vh;
            overflow-y: auto;
            border: 2px solid rgba(255, 20, 147, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: fadeInHome 0.3s ease;
        }
        
        /* Reduce scrolling - make content fit better */
        @media screen and (max-height: 700px) {
            .help-content {
                max-height: 90vh;
                padding: clamp(15px, 2vh, 18px) clamp(14px, 3vw, 18px);
            }
            .help-header {
                margin-bottom: clamp(10px, 1.5vh, 15px);
            }
            .help-instruction-item {
                margin-bottom: clamp(8px, 1vh, 12px);
                padding: clamp(6px, 1vh, 10px);
            }
        }
        
        .help-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: clamp(15px, 2vh, 20px);
        }
        
        .help-title {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 900;
            color: #FF1493;
            text-shadow: 0 0 20px rgba(255, 20, 147, 0.6);
        }
        
        .help-close {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .help-close:active {
            transform: scale(0.9);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .help-instructions {
            color: #fff;
        }
        
        .help-instruction-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: clamp(10px, 1.5vh, 14px);
            padding: clamp(8px, 1.5vh, 12px);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid #FF1493;
        }
        
        .help-instruction-icon {
            font-size: clamp(1.5rem, 4vw, 2rem);
            flex-shrink: 0;
        }
        
        .help-instruction-text {
            font-size: clamp(0.85rem, 2.5vw, 1.1rem);
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .loading-content {
            text-align: center;
            animation: fadeInLoading 1s ease;
        }
        
        .loading-logo {
            width: clamp(80px, 20vw, 150px);
            height: clamp(80px, 20vw, 150px);
            margin-bottom: clamp(20px, 5vh, 40px);
            animation: pulseLoading 2s ease-in-out infinite;
        }
        
        .loading-logo-text {
            font-size: clamp(3rem, 15vw, 5rem);
            font-weight: 900;
            color: #FF1493;
            text-shadow: 0 0 30px rgba(255, 20, 147, 0.8);
        }
        
        .loading-title {
            font-size: clamp(1rem, 4vw, 1.8rem);
            color: #fff;
            font-weight: 900;
            margin-bottom: clamp(10px, 2vh, 20px);
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            letter-spacing: 1px;
        }
        
        .loading-spinner {
            width: clamp(40px, 10vw, 60px);
            height: clamp(40px, 10vw, 60px);
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #FF1493;
            border-radius: 50%;
            animation: spinLoading 1s linear infinite;
            margin: clamp(20px, 5vh, 40px) auto;
        }
        
        .loading-text {
            font-size: clamp(0.8rem, 3vw, 1.2rem);
            color: rgba(255, 255, 255, 0.9);
            margin-top: clamp(5px, 1vh, 10px);
            animation: blinkLoading 1.5s ease-in-out infinite;
        }
        
        .loading-progress {
            width: clamp(200px, 60vw, 300px);
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: clamp(20px, 4vh, 30px) auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF1493, #FF69B4);
            border-radius: 10px;
            animation: progressBarLoading 2s ease-in-out infinite;
            box-shadow: 0 0 15px rgba(255, 20, 147, 0.8);
        }
        
        @keyframes fadeInLoading {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulseLoading {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes spinLoading {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes blinkLoading {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes progressBarLoading {
            0% { width: 0%; }
            100% { width: 100%; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-content">
            <div class="loading-logo">
                <div class="loading-logo-text">üèóÔ∏è</div>
            </div>
            <h1 class="loading-title">TOWER BLOCKS</h1>
            <div class="loading-spinner"></div>
            <p class="loading-text">Loading Game...</p>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>
    
    <script src="jiogames_sp_wrapper.js"></script>
    <script>
        // Console logging for debugging
        console.log("Tower Blocks Smartphone - Game Initialized");
        
        // Force landscape orientation function
        function lockOrientation() {
            try {
                if (screen.orientation && screen.orientation.lock) {
                    screen.orientation.lock('landscape').then(
                        function() { console.log("Tower Blocks: Orientation locked to landscape"); },
                        function(error) { 
                            // Don't log error if it's just not supported
                            if (error.name !== 'NotSupportedError') {
                                console.log("Tower Blocks: Orientation lock failed:", error);
                            }
                        }
                    );
                } else if (screen.lockOrientation) {
                    screen.lockOrientation('landscape');
                    console.log("Tower Blocks: Orientation locked (legacy API)");
                } else if (screen.mozLockOrientation) {
                    screen.mozLockOrientation('landscape');
                    console.log("Tower Blocks: Orientation locked (Mozilla)");
                } else if (screen.msLockOrientation) {
                    screen.msLockOrientation('landscape');
                    console.log("Tower Blocks: Orientation locked (MS)");
                } else {
                    console.log("Tower Blocks: Screen orientation lock not supported");
                }
            } catch (error) {
                // Don't log error if it's just not supported
                if (error.name !== 'NotSupportedError') {
                    console.log("Tower Blocks: Error locking orientation:", error);
                }
            }
        }
        
        // Global function to lock orientation (will be called on game start)
        window.lockGameOrientation = lockOrientation;
        
        // Handle orientation change - reload page for proper layout (only before game starts)
        let gameStarted = false;
        let orientationChangeTimeout;
        let hasReloaded = false;
        let isFullscreenActive = false; // Track fullscreen state
        
        // Check if we've already reloaded in this session
        if (sessionStorage.getItem('towerBlocksReloaded') === 'true') {
            hasReloaded = true;
        }
        
        function handleOrientationChange() {
            // Don't reload if game has already started or if we've already reloaded
            if (gameStarted || hasReloaded) {
                console.log("Tower Blocks: Orientation changed but game already started or already reloaded, skipping reload");
                return;
            }
            
            console.log("Tower Blocks: Orientation changed");
            clearTimeout(orientationChangeTimeout);
            orientationChangeTimeout = setTimeout(function() {
                // Check if now in landscape and we haven't reloaded yet
                if (window.matchMedia("(orientation: landscape)").matches && !hasReloaded) {
                    console.log("Tower Blocks: Now in landscape, reloading...");
                    hasReloaded = true;
                    sessionStorage.setItem('towerBlocksReloaded', 'true');
                    window.location.reload();
                }
            }, 500); // Increased timeout to prevent rapid reloads
        }
        
        // Only listen for orientation changes if we're in portrait mode initially
        if (window.matchMedia("(orientation: portrait)").matches) {
            window.addEventListener('orientationchange', handleOrientationChange);
            window.addEventListener('resize', handleOrientationChange);
            
            // Listen for screen orientation API
            if (screen.orientation) {
                screen.orientation.addEventListener('change', function() {
                    if (!gameStarted && !hasReloaded) {
                        console.log("Tower Blocks: Screen orientation changed to " + screen.orientation.type);
                        handleOrientationChange();
                    }
                });
            }
        }
        
        // Mark game as started when container class changes to 'playing'
        setTimeout(function() {
            const container = document.getElementById('container');
            if (container) {
                // Use MutationObserver to detect when game starts
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            if (container.classList.contains('playing') || container.classList.contains('resetting')) {
                                console.log("Tower Blocks: Game started, disabling reload on orientation change");
                                gameStarted = true;
                                // Clear the reload flag when game starts
                                sessionStorage.removeItem('towerBlocksReloaded');
                            }
                        }
                    });
                });
                observer.observe(container, { attributes: true });
            }
        }, 500);
        
        window.addEventListener('load', function() {
                    console.log("Tower Blocks - Page Loaded");
                    
                    // Lock orientation immediately on page load (like PUBG)
                    lockOrientation();
                    
                        // Auto fullscreen on load
                        setTimeout(function() {
                            if (typeof forceFullscreen === 'function') {
                                forceFullscreen();
                            }
                        }, 1000);
                        
                        // Add double-tap fullscreen for game streaming
                        if (typeof addDoubleTapFullscreen === 'function') {
                            addDoubleTapFullscreen();
                        }
                        
                        // Add smartphone landscape mode logic
                        if (typeof addSmartphoneLandscapeLogic === 'function') {
                            addSmartphoneLandscapeLogic();
                        }
                        
                        // Simple touch-to-start functionality restored
                    
                    // Auto fullscreen will trigger after 1 second
                    
                    // Listen for fullscreen changes
                    document.addEventListener('fullscreenchange', function() {
                        isFullscreenActive = !!document.fullscreenElement;
                        console.log("Tower Blocks: Fullscreen changed, active:", isFullscreenActive);
                    });
                    
                    document.addEventListener('webkitfullscreenchange', function() {
                        isFullscreenActive = !!document.webkitFullscreenElement;
                        console.log("Tower Blocks: Webkit fullscreen changed, active:", isFullscreenActive);
                    });
                    
                    document.addEventListener('mozfullscreenchange', function() {
                        isFullscreenActive = !!document.mozFullScreenElement;
                        console.log("Tower Blocks: Mozilla fullscreen changed, active:", isFullscreenActive);
                    });
                    
                    document.addEventListener('MSFullscreenChange', function() {
                        isFullscreenActive = !!document.msFullscreenElement;
                        console.log("Tower Blocks: MS fullscreen changed, active:", isFullscreenActive);
                    });
            
            // Hide loading screen after splash completes, then show home screen
            setTimeout(function() {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.classList.add('loaded');
                    console.log("Tower Blocks: Loading screen (splash) hidden");
                    
                    // Show home screen AFTER loading screen is hidden
                    setTimeout(function() {
                        const homeScreen = document.getElementById('homeScreen');
                        if (homeScreen) {
                            // Force show home screen with multiple methods
                            homeScreen.classList.add('show');
                            homeScreen.style.display = 'flex';
                            homeScreen.style.visibility = 'visible';
                            homeScreen.style.opacity = '1';
                            homeScreen.style.zIndex = '10000';
                            console.log("Tower Blocks: Home screen shown after splash");
                        } else {
                            console.error("Tower Blocks: Home screen element not found!");
                        }
                    }, 300); // Small delay after splash hides to ensure smooth transition
                }
            }, 3000); // Hide splash after 3 seconds (reduced from 5 for better UX)
            
            // Home screen button handlers and overlay logic
            const homeScreen = document.getElementById('homeScreen');
            const helpModal = document.getElementById('helpModal');
            const btnStartGame = document.getElementById('btnStartGame');
            const btnHelp = document.getElementById('btnHelp');
            const btnCloseHelp = document.getElementById('btnCloseHelp');

            function showHomeScreen() {
                if (!homeScreen) return;
                homeScreen.classList.add('show');
                homeScreen.style.display = 'flex';
                homeScreen.style.visibility = 'visible';
                homeScreen.style.opacity = '1';
                homeScreen.style.zIndex = '10000';
            }

            function hideHomeScreen() {
                if (!homeScreen) return;
                homeScreen.classList.remove('show');
                homeScreen.style.display = 'none';
                homeScreen.style.visibility = 'hidden';
                homeScreen.style.opacity = '0';
                homeScreen.style.zIndex = '-1';
            }

            function showHelp() {
                if (!helpModal) return;
                helpModal.classList.add('show');
                helpModal.style.display = 'flex';
                helpModal.style.visibility = 'visible';
                helpModal.style.opacity = '1';
                helpModal.style.zIndex = '10001';
            }

            function hideHelp() {
                if (!helpModal) return;
                helpModal.classList.remove('show');
                helpModal.style.display = 'none';
                helpModal.style.visibility = 'hidden';
                helpModal.style.opacity = '0';
            }

            function triggerGameStart() {
                const container = document.getElementById('container');
                const instructions = document.getElementById('instructions');
                
                if (container) {
                    container.classList.add('game-started');
                    container.style.visibility = 'visible';
                    container.style.opacity = '1';
                    container.style.pointerEvents = 'auto';
                }

                // Hide instructions immediately
                if (instructions) {
                    instructions.classList.add('hide');
                    instructions.style.display = 'none';
                }

                // Directly call the game's startGame method instead of simulating clicks
                try {
                    if (typeof game !== 'undefined' && game && typeof game.startGame === 'function') {
                        // Give a small delay for UI to settle
                        setTimeout(function() {
                            game.startGame();
                            console.log('Tower Blocks: Game started from home screen');
                        }, 100);
                    } else {
                        console.warn('Tower Blocks: game object or startGame method not available');
                    }
                } catch (e) {
                    console.error('Tower Blocks: Failed to start game', e);
                }
            }

            window.tbShowHomeScreen = showHomeScreen;
            window.tbHideHomeScreen = hideHomeScreen;
            window.tbHideHelp = hideHelp;

            if (btnStartGame) {
                btnStartGame.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    hideHelp();
                    hideHomeScreen();
                    
                    // Direct call to Jio wrapper gameCacheAd() function
                    gameCacheAd();
                    
                    triggerGameStart();
                });
            }

            if (btnHelp) {
                btnHelp.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    showHelp();
                });
            }

            if (btnCloseHelp) {
                btnCloseHelp.addEventListener('click', function (e) {
                    e.preventDefault();
                    e.stopPropagation();
                    hideHelp();
                });
            }

            if (helpModal) {
                helpModal.addEventListener('click', function (e) {
                    if (e.target === helpModal) {
                        e.preventDefault();
                        e.stopPropagation();
                        hideHelp();
                    }
                });
            }

            // Don't show home screen early - wait for splash to complete first
            // Home screen will be shown after loading screen hides (see above)
            
            // JioGames SDK Integration - Get user profile on game load
            setTimeout(function() {
                // Load and show banner only at start, and prepare one interstitial in background
                try{
                    if (typeof loadBanner === 'function') { loadBanner(); }
                    setTimeout(function(){ 
                        if (typeof showBanner === 'function') { 
                            showBanner(); 
                            if (typeof setBottomBanner === 'function') { setBottomBanner(); }
                            // After banner shows, cache interstitial once in background (no retries)
                        } 
                    }, 400);
                }catch(e){}
            }, 1000);
            
            // Add click listener to start button to lock orientation
            setTimeout(function() {
                const startButton = document.getElementById('start-button');
                const gameContainer = document.getElementById('container');
                const startPauseButton = document.getElementById('start-pause-button');
                
                if (startButton) {
                    // Add click event listener to start button
                    startButton.addEventListener('click', function() {
                        console.log("Tower Blocks: Start button clicked - Locking orientation");
                        if (typeof window.lockGameOrientation === 'function') {
                            window.lockGameOrientation();
                        }
                        // Hide banner when game starts
                        try{ if (typeof hideBanner === 'function') { hideBanner(); } }catch(e){}
                        // Prevent fullscreen from interfering with game
                        fullscreenAttempted = true;
                        
                        // Hide start button when game starts
                        if (startPauseButton) {
                            startPauseButton.style.display = 'none';
                        }
                    });
                    
                    // Touch event removed to prevent drag notifications
                }
                
                // Also add listener to container for game start (backup)
                if (gameContainer) {
                    gameContainer.addEventListener('click', function(e) {
                        // Check if game-ready is visible (meaning game is starting)
                        const gameReady = document.querySelector('.game-ready');
                        if (gameReady && getComputedStyle(gameReady).display !== 'none') {
                            console.log("Tower Blocks: Game starting - Locking orientation");
                            if (typeof window.lockGameOrientation === 'function') {
                                window.lockGameOrientation();
                            }
                            // Hide banner when game starts (backup)
                            try{ if (typeof hideBanner === 'function') { hideBanner(); } }catch(e){}
                            
                            // Hide start button when game starts
                            if (startPauseButton) {
                                startPauseButton.style.display = 'none';
                            }
                        }
                    });
                }
                
                // Monitor game state changes to show/hide button
                if (gameContainer && startPauseButton) {
                    const observer = new MutationObserver(function(mutations) {
                        mutations.forEach(function(mutation) {
                            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                                const isReady = gameContainer.classList.contains('ready');
                                const isEnded = gameContainer.classList.contains('ended');
                                const isPlaying = gameContainer.classList.contains('playing') || gameContainer.classList.contains('resetting');
                                try {
                                    var ib = document.getElementById('instructions-bg');
                                    if (ib) { ib.style.display = isReady ? 'block' : 'none'; }
                                } catch(e){}
                                
                                if (isReady) {
                                    // Game is ready, show start button
                                    startPauseButton.style.display = 'flex';
                                } else if (isEnded) {
                                    // Game ended, show start button again
                                    startPauseButton.style.display = 'flex';
                                }
                            }
                        });
                    });
                    observer.observe(gameContainer, { attributes: true });
                }
            }, 100); // Small delay to ensure DOM is ready
        });
    </script>
    <script  src="app.js?v=22" async></script>
<div id="rotate-text">Rotate your phone</div>

<!-- Home Screen -->
<div id="homeScreen">
    <div class="home-content">
        <h1 class="home-title">üèóÔ∏è TOWER BLOCKS</h1>
        <p class="home-subtitle">Stack blocks as high as you can!</p>
        <div class="home-buttons">
            <button id="btnStartGame" class="home-btn home-btn-start">START GAME</button>
            <button id="btnHelp" class="home-btn home-btn-help">HELP</button>
        </div>
    </div>
</div>

<!-- Help Modal -->
<div id="helpModal">
    <div class="help-content">
        <div class="help-header">
            <h2 class="help-title">üìñ How to Play</h2>
            <button id="btnCloseHelp" class="help-close">‚úï</button>
        </div>
        <div class="help-instructions">
            <div class="help-instruction-item">
                <span class="help-instruction-icon">üëÜ</span>
                <p class="help-instruction-text">Tap the screen to place your block</p>
            </div>
            <div class="help-instruction-item">
                <span class="help-instruction-icon">üì±</span>
                <p class="help-instruction-text">Keep your device in landscape mode for best experience</p>
            </div>
            <div class="help-instruction-item">
                <span class="help-instruction-icon">üèóÔ∏è</span>
                <p class="help-instruction-text">Stack blocks as high as you can without missing!</p>
            </div>
            <div class="help-instruction-item">
                <span class="help-instruction-icon">üéØ</span>
                <p class="help-instruction-text">Try to beat your high score!</p>
            </div>
            <div class="help-instruction-item">
                <span class="help-instruction-icon">‚ö°</span>
                <p class="help-instruction-text">Precision is key - time your taps perfectly!</p>
            </div>
        </div>
    </div>
</div>

<div id="container">
	<div id="game"></div>
	<div id="instructions-bg">    </div>
    
    <!-- Home Screen -->
    
    <!-- Help Modal -->
    
	<div id="score">0</div>
	<div id="instructions"></div>
	<div class="game-over">
		<div class="game-over-content">
			<h2>Game Over</h2>
			<div class="final-score-display">
				<span class="score-label">Final Score</span>
				<span id="final-score" class="score-number">0</span>
			</div>
			<p class="congrats-text">Great job! You're amazing!</p>
			<p class="restart-text">Touch to play again</p>
		</div>
	</div>
                <div class="game-ready">
                    <div class="how-to-play">
                        <h3>üéÆ How to Play</h3>
                        <div class="instruction-item">
                            <span class="icon">üëÜ</span>
                            <p>Tap the screen to place your block</p>
                        </div>
                        <div class="instruction-item">
                            <span class="icon">üì±</span>
                            <p>Keep your device in landscape mode</p>
                        </div>
                        <div class="instruction-item">
                            <span class="icon">üèóÔ∏è</span>
                            <p>Stack blocks as high as you can!</p>
                        </div>
                        <div class="instruction-item">
                            <span class="icon">üéØ</span>
                            <p>Try to beat your high score!</p>
                        </div>
                    </div>
                </div>
	<!-- Exit button -->
	<div id="exit-button" onclick="exitToMainMenu()">‚úï</div>
                <!-- Fullscreen button -->
                <div id="fullscreen-icon" onclick="toggleFullscreenOnly()">‚õ∂</div>

</div>
<footer>Tower Blocks 2025</footer>
<script>
// Flag to prevent multiple exitToMainMenu calls
var isExitingToMainMenu = false;

function exitToMainMenu() {
    // Prevent multiple calls
    if (isExitingToMainMenu) {
        console.warn("Tower Blocks: exitToMainMenu already in progress, skipping duplicate call");
        return;
    }
    
    isExitingToMainMenu = true;
    console.log("Tower Blocks: Exit button clicked");
    
    try {
        if (typeof window.tbHideHelp === 'function') {
            window.tbHideHelp();
        }
    } catch (e) { console.log(e); }
    try {
        if (typeof window.tbResetGameToReady === 'function') {
            window.tbResetGameToReady();
        } else if (typeof game !== 'undefined' && game && typeof game.resetToReady === 'function') {
            game.resetToReady();
        }
    } catch (e) { console.log(e); }
    try {
        if (typeof window.tbShowHomeScreen === 'function') {
            window.tbShowHomeScreen();
        }
    } catch (e) { console.log(e); }
    try {
        if (typeof gameCacheAd === 'function') {
            gameCacheAd();
        }
    } catch (e) { console.log(e); }
    // Direct call to Jio wrapper showAd() function
    try {
        showAd();
    } catch (e) { console.log(e); }
    
    // Reset flag after a short delay to allow the function to complete
    setTimeout(function() {
        isExitingToMainMenu = false;
    }, 1000);
}

// Global variable to track game state (already declared above)


            function addDoubleTapFullscreen() {
                console.log("Tower Blocks: Adding double-tap fullscreen for game streaming");
                
                let tapCount = 0;
                let tapTimer = null;
                
                // Double-tap detection for fullscreen
                document.addEventListener('touchend', function(e) {
                    if (isFullscreenActive) return;
                    
                    tapCount++;
                    console.log("Tower Blocks: Tap count:", tapCount);
                    
                    if (tapCount === 1) {
                        tapTimer = setTimeout(function() {
                            tapCount = 0;
                        }, 1000);
                    } else if (tapCount === 2) {
                        clearTimeout(tapTimer);
                        tapCount = 0;
                        console.log("Tower Blocks: Double tap detected! Going fullscreen...");
                        toggleFullscreen();
                    }
                }, { passive: true });
            }


            function addSmartphoneLandscapeLogic() {
                console.log("Tower Blocks: Adding smartphone landscape mode logic");
                
                // Check if we're in landscape mode on smartphone
                function isSmartphoneLandscape() {
                    return window.matchMedia("(orientation: landscape)").matches && 
                           window.innerWidth <= 1024 && 
                           /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                }
                
                if (isSmartphoneLandscape()) {
                    console.log("Tower Blocks: Smartphone landscape mode detected");
                    
                    // Auto fullscreen in landscape mode
                    setTimeout(function() {
                        console.log("Tower Blocks: Auto fullscreen in landscape mode");
                        toggleFullscreen();
                    }, 1000);
                    
                    // Modify touch events on game area for landscape mode
                    const gameContainer = document.getElementById('container');
                    if (gameContainer) {
                        // Allow touch events but show instruction to use box icon
                        gameContainer.addEventListener('touchstart', function(e) {
                            console.log("Tower Blocks: Touch detected on game area in landscape mode - use box icon instead");
                            // Don't prevent default, just log
                        }, { passive: true });
                        
                        gameContainer.addEventListener('touchend', function(e) {
                            console.log("Tower Blocks: Touch end detected on game area in landscape mode - use box icon instead");
                            // Don't prevent default, just log
                        }, { passive: true });
                    }
                    
                }
            }


            function toggleFullscreen() {
                console.log("Tower Blocks: Toggle fullscreen called");
                
                // Check if currently in fullscreen
                const isCurrentlyFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);
                
                if (isCurrentlyFullscreen) {
                    // Exit fullscreen
                    console.log("Tower Blocks: Exiting fullscreen");
                    isFullscreenActive = false;
                    
                    if (document.exitFullscreen) {
                        document.exitFullscreen().catch(err => {
                            console.log("Tower Blocks: Exit fullscreen failed:", err);
                        });
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                } else {
                    // Enter fullscreen
                    console.log("Tower Blocks: Entering fullscreen");
                    isFullscreenActive = true;
                    fullscreenAttempted = true;
                    
                    // Try multiple methods for different browsers
                    const fullscreenMethods = [
                        () => document.documentElement.requestFullscreen(),
                        () => document.documentElement.webkitRequestFullscreen(),
                        () => document.documentElement.mozRequestFullScreen(),
                        () => document.documentElement.msRequestFullscreen(),
                        () => document.body.requestFullscreen(),
                        () => document.body.webkitRequestFullscreen()
                    ];
                    
                    let methodIndex = 0;
                    const tryNextMethod = () => {
                        if (methodIndex < fullscreenMethods.length) {
                            try {
                                fullscreenMethods[methodIndex]().catch(err => {
                                    console.log("Tower Blocks: Fullscreen method", methodIndex, "failed:", err);
                                    methodIndex++;
                                    setTimeout(tryNextMethod, 100);
                                });
                            } catch (err) {
                                console.log("Tower Blocks: Fullscreen method", methodIndex, "error:", err);
                                methodIndex++;
                                setTimeout(tryNextMethod, 100);
                            }
                        }
                    };
                    
                    tryNextMethod();
                    
                    // Hide address bar on mobile - multiple attempts
                    setTimeout(function() {
                        window.scrollTo(0, 1);
                    }, 100);
                    
                    setTimeout(function() {
                        window.scrollTo(0, 1);
                    }, 500);
                    
                    setTimeout(function() {
                        window.scrollTo(0, 1);
                    }, 1000);
                    
                    // Force hide browser UI
                    setTimeout(function() {
                        if (window.navigator && window.navigator.standalone !== true) {
                            window.scrollTo(0, 1);
                        }
                    }, 2000);
                }
            }

            function toggleFullscreenOnly() {
                console.log("Tower Blocks: Toggle fullscreen ONLY called - no game start");
                
                // Prevent event propagation to stop game from starting
                event.stopPropagation();
                event.preventDefault();
                
                // Check if currently in fullscreen
                const isCurrentlyFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);
                
                if (isCurrentlyFullscreen) {
                    // Exit fullscreen
                    console.log("Tower Blocks: Exiting fullscreen (fullscreen only)");
                    isFullscreenActive = false;
                    
                    if (document.exitFullscreen) {
                        document.exitFullscreen().catch(err => {
                            console.log("Tower Blocks: Exit fullscreen failed:", err);
                        });
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                } else {
                    // Enter fullscreen
                    console.log("Tower Blocks: Entering fullscreen (fullscreen only)");
                    isFullscreenActive = true;
                    fullscreenAttempted = true;
                    
                    // Try multiple methods for different browsers
                    const fullscreenMethods = [
                        () => document.documentElement.requestFullscreen(),
                        () => document.documentElement.webkitRequestFullscreen(),
                        () => document.documentElement.mozRequestFullScreen(),
                        () => document.documentElement.msRequestFullscreen(),
                        () => document.body.requestFullscreen(),
                        () => document.body.webkitRequestFullscreen()
                    ];
                    
                    let methodIndex = 0;
                    const tryNextMethod = () => {
                        if (methodIndex < fullscreenMethods.length) {
                            try {
                                fullscreenMethods[methodIndex]().catch(err => {
                                    console.log("Tower Blocks: Fullscreen method", methodIndex, "failed:", err);
                                    methodIndex++;
                                    setTimeout(tryNextMethod, 100);
                                });
                            } catch (err) {
                                console.log("Tower Blocks: Fullscreen method", methodIndex, "error:", err);
                                methodIndex++;
                                setTimeout(tryNextMethod, 100);
                            }
                        }
                    };
                    
                    tryNextMethod();
                    
                    // Hide address bar on mobile - multiple attempts
                    setTimeout(function() {
                        window.scrollTo(0, 1);
                    }, 100);
                    
                    setTimeout(function() {
                        window.scrollTo(0, 1);
                    }, 500);
                    
                    setTimeout(function() {
                        window.scrollTo(0, 1);
                    }, 1000);
                    
                    // Force hide browser UI
                    setTimeout(function() {
                        if (window.navigator && window.navigator.standalone !== true) {
                            window.scrollTo(0, 1);
                        }
                    }, 2000);
                }
            }

            // Enhanced fullscreen function for mobile
            function forceFullscreen() {
                console.log("Tower Blocks: Force fullscreen called");
                
                // Try to enter fullscreen
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log("Tower Blocks: requestFullscreen failed:", err);
                    });
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.mozRequestFullScreen) {
                    document.documentElement.mozRequestFullScreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                }
                
                // Force hide address bar
                setTimeout(function() {
                    window.scrollTo(0, 1);
                }, 100);
                
                setTimeout(function() {
                    window.scrollTo(0, 1);
                }, 500);
                
                setTimeout(function() {
                    window.scrollTo(0, 1);
                }, 1000);
                
                // Additional mobile fullscreen attempts
                setTimeout(function() {
                    if (screen.orientation) {
                        screen.orientation.lock('landscape').catch(err => {
                            console.log("Tower Blocks: Orientation lock failed:", err);
                        });
                    }
                }, 2000);
            }

</script>
</body>
</html>

