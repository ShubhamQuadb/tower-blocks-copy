<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1.0,maximum-scale=1.0,viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="screen-orientation" content="landscape">
    <meta name="x5-orientation" content="landscape">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-navbutton-color" content="#000000">
    <meta name="apple-mobile-web-app-title" content="Tower Blocks">
    <meta name="application-name" content="Tower Blocks">
<script src="https://codepen.io/steveg3003/pen/zBVakw"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r83/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
    <title>Block Tower</title>
    
    
    <link rel="stylesheet" href="style.css?v=22" />
    <style>
        /* Force everything to landscape - hide all content in portrait */
        @media screen and (orientation: portrait) {
            body {
                overflow: hidden;
            }
            
            #loadingScreen,
            #container,
            footer {
                display: none !important;
            }
            
            body::before {
                content: "üîÑ";
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 100px;
                z-index: 9999;
            }
            
            body::after {
                content: "";
                display: none;
            }
            
            #rotate-text {
                position: fixed;
                top: 60%;
                left: 50%;
                transform: translateX(-50%);
                color: #fff;
                font-size: 20px;
                text-align: center;
                width: 80%;
                z-index: 9999;
                font-family: 'Comfortaa', cursive;
                font-weight: 600;
                display: block !important;
                background: rgba(0, 0, 0, 0.7);
                padding: 10px 20px;
                border-radius: 10px;
                border: 2px solid #fff;
            }
            
        }
        
        /* Hide rotate text in landscape mode */
        @media screen and (orientation: landscape) {
            #rotate-text {
                display: none !important;
            }
        }
        
        /* Fullscreen and landscape mode optimizations */
        html, body {
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            position: fixed;
            top: 0;
            left: 0;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            height: 100dvh;
            position: fixed;
            top: 0;
            left: 0;
        }
        
        #game {
            width: 100%;
            height: 100%;
        }
        
        /* Landscape mode optimizations for all smartphones */
        @media screen and (orientation: landscape) {
            html, body {
                width: 100vw;
                height: 100vh;
                height: 100dvh;
                position: fixed;
                overflow: hidden;
            }
            
            #container {
                width: 100vw;
                height: 100vh;
                height: 100dvh;
                padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            }
            
            #game {
                width: 100%;
                height: 100%;
            }
        }
        
        /* Specific fixes for high-resolution devices (Samsung S24, etc.) */
        @media screen and (orientation: landscape) and (min-width: 800px) {
            #score {
                font-size: clamp(3rem, 8vw, 5rem) !important;
            }
            
            #instructions {
                font-size: clamp(1.2rem, 3vw, 1.8rem) !important;
            }
            
            .game-ready h3, .game-over h2 {
                font-size: clamp(2rem, 5vw, 3rem) !important;
            }
            
            .game-ready p, .game-over p {
                font-size: clamp(1rem, 2.5vw, 1.4rem) !important;
            }
            
            #start-button {
                font-size: clamp(1.5rem, 4vw, 2.2rem) !important;
                padding: clamp(15px, 2.5vh, 25px) clamp(40px, 6vw, 60px) !important;
            }
        }
        
        /* Loading Screen Styles */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #1a0b2e 0%, #16213e 50%, #0f3460 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        
        #loadingScreen.loaded {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        
        .loading-content {
            text-align: center;
            animation: fadeInLoading 1s ease;
        }
        
        .loading-logo {
            width: clamp(80px, 20vw, 150px);
            height: clamp(80px, 20vw, 150px);
            margin-bottom: clamp(20px, 5vh, 40px);
            animation: pulseLoading 2s ease-in-out infinite;
        }
        
        .loading-logo-text {
            font-size: clamp(3rem, 15vw, 5rem);
            font-weight: 900;
            color: #FF1493;
            text-shadow: 0 0 30px rgba(255, 20, 147, 0.8);
        }
        
        .loading-title {
            font-size: clamp(1rem, 4vw, 1.8rem);
            color: #fff;
            font-weight: 900;
            margin-bottom: clamp(10px, 2vh, 20px);
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
            letter-spacing: 1px;
        }
        
        .loading-spinner {
            width: clamp(40px, 10vw, 60px);
            height: clamp(40px, 10vw, 60px);
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #FF1493;
            border-radius: 50%;
            animation: spinLoading 1s linear infinite;
            margin: clamp(20px, 5vh, 40px) auto;
        }
        
        .loading-text {
            font-size: clamp(0.8rem, 3vw, 1.2rem);
            color: rgba(255, 255, 255, 0.9);
            margin-top: clamp(5px, 1vh, 10px);
            animation: blinkLoading 1.5s ease-in-out infinite;
        }
        
        .loading-progress {
            width: clamp(200px, 60vw, 300px);
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: clamp(20px, 4vh, 30px) auto;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF1493, #FF69B4);
            border-radius: 10px;
            animation: progressBarLoading 2s ease-in-out infinite;
            box-shadow: 0 0 15px rgba(255, 20, 147, 0.8);
        }
        
        @keyframes fadeInLoading {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulseLoading {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes spinLoading {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes blinkLoading {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes progressBarLoading {
            0% { width: 0%; }
            100% { width: 100%; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loading-content">
            <div class="loading-logo">
                <div class="loading-logo-text">üèóÔ∏è</div>
            </div>
            <h1 class="loading-title">TOWER BLOCKS</h1>
            <div class="loading-spinner"></div>
            <p class="loading-text">Loading Game...</p>
            <div class="loading-progress">
                <div class="loading-progress-bar"></div>
            </div>
        </div>
    </div>
    
    <script src="jiogames_sp_wrapper.js"></script>
    <script>
        // Console logging for debugging
        console.log("Tower Blocks Smartphone - Game Initialized");
        
        // Force landscape orientation function
        function lockOrientation() {
            try {
                if (screen.orientation && screen.orientation.lock) {
                    screen.orientation.lock('landscape').then(
                        function() { console.log("Tower Blocks: Orientation locked to landscape"); },
                        function(error) { 
                            // Don't log error if it's just not supported
                            if (error.name !== 'NotSupportedError') {
                                console.log("Tower Blocks: Orientation lock failed:", error);
                            }
                        }
                    );
                } else if (screen.lockOrientation) {
                    screen.lockOrientation('landscape');
                    console.log("Tower Blocks: Orientation locked (legacy API)");
                } else if (screen.mozLockOrientation) {
                    screen.mozLockOrientation('landscape');
                    console.log("Tower Blocks: Orientation locked (Mozilla)");
                } else if (screen.msLockOrientation) {
                    screen.msLockOrientation('landscape');
                    console.log("Tower Blocks: Orientation locked (MS)");
                } else {
                    console.log("Tower Blocks: Screen orientation lock not supported");
                }
            } catch (error) {
                // Don't log error if it's just not supported
                if (error.name !== 'NotSupportedError') {
                    console.log("Tower Blocks: Error locking orientation:", error);
                }
            }
        }
        
        // Global function to lock orientation (will be called on game start)
        window.lockGameOrientation = lockOrientation;
        
        // Handle orientation change - reload page for proper layout (only before game starts)
        let gameStarted = false;
        let orientationChangeTimeout;
        let hasReloaded = false;
        
        // Check if we've already reloaded in this session
        if (sessionStorage.getItem('towerBlocksReloaded') === 'true') {
            hasReloaded = true;
        }
        
        function handleOrientationChange() {
            // Don't reload if game has already started or if we've already reloaded
            if (gameStarted || hasReloaded) {
                console.log("Tower Blocks: Orientation changed but game already started or already reloaded, skipping reload");
                return;
            }
            
            console.log("Tower Blocks: Orientation changed");
            clearTimeout(orientationChangeTimeout);
            orientationChangeTimeout = setTimeout(function() {
                // Check if now in landscape and we haven't reloaded yet
                if (window.matchMedia("(orientation: landscape)").matches && !hasReloaded) {
                    console.log("Tower Blocks: Now in landscape, reloading...");
                    hasReloaded = true;
                    sessionStorage.setItem('towerBlocksReloaded', 'true');
                    window.location.reload();
                }
            }, 500); // Increased timeout to prevent rapid reloads
        }
        
        // Only listen for orientation changes if we're in portrait mode initially
        if (window.matchMedia("(orientation: portrait)").matches) {
            window.addEventListener('orientationchange', handleOrientationChange);
            window.addEventListener('resize', handleOrientationChange);
            
            // Listen for screen orientation API
            if (screen.orientation) {
                screen.orientation.addEventListener('change', function() {
                    if (!gameStarted && !hasReloaded) {
                        console.log("Tower Blocks: Screen orientation changed to " + screen.orientation.type);
                        handleOrientationChange();
                    }
                });
            }
        }
        
        // Mark game as started when container class changes to 'playing'
        setTimeout(function() {
            const container = document.getElementById('container');
            if (container) {
                // Use MutationObserver to detect when game starts
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            if (container.classList.contains('playing') || container.classList.contains('resetting')) {
                                console.log("Tower Blocks: Game started, disabling reload on orientation change");
                                gameStarted = true;
                                // Clear the reload flag when game starts
                                sessionStorage.removeItem('towerBlocksReloaded');
                            }
                        }
                    });
                });
                observer.observe(container, { attributes: true });
            }
        }, 500);
        
                window.addEventListener('load', function() {
                    console.log("Tower Blocks - Page Loaded");
                    
                    // Lock orientation immediately on page load (like PUBG)
                    lockOrientation();
                    
                        // Auto fullscreen on load
                        setTimeout(function() {
                            if (typeof forceFullscreen === 'function') {
                                forceFullscreen();
                            }
                        }, 1000);
                        
                        // Add double-tap fullscreen for game streaming
                        if (typeof addDoubleTapFullscreen === 'function') {
                            addDoubleTapFullscreen();
                        }
                        
                        // Add smartphone landscape mode logic
                        if (typeof addSmartphoneLandscapeLogic === 'function') {
                            addSmartphoneLandscapeLogic();
                        }
                        
                        // Simple touch-to-start functionality restored
                    
                    // Auto fullscreen will trigger after 1 second
                    
                    // Listen for fullscreen changes
                    document.addEventListener('fullscreenchange', function() {
                        isFullscreenActive = !!document.fullscreenElement;
                        console.log("Tower Blocks: Fullscreen changed, active:", isFullscreenActive);
                    });
                    
                    document.addEventListener('webkitfullscreenchange', function() {
                        isFullscreenActive = !!document.webkitFullscreenElement;
                        console.log("Tower Blocks: Webkit fullscreen changed, active:", isFullscreenActive);
                    });
                    
                    document.addEventListener('mozfullscreenchange', function() {
                        isFullscreenActive = !!document.mozFullScreenElement;
                        console.log("Tower Blocks: Mozilla fullscreen changed, active:", isFullscreenActive);
                    });
                    
                    document.addEventListener('MSFullscreenChange', function() {
                        isFullscreenActive = !!document.msFullscreenElement;
                        console.log("Tower Blocks: MS fullscreen changed, active:", isFullscreenActive);
                    });
            
            // Hide loading screen after game loads
            setTimeout(function() {
                const loadingScreen = document.getElementById('loadingScreen');
                if (loadingScreen) {
                    loadingScreen.classList.add('loaded');
                    console.log("Tower Blocks: Loading screen hidden");
                }
            }, 5000); // Hide after 5 seconds
            
            // JioGames SDK Integration - Get user profile on game load
            setTimeout(function() {
                if (typeof getUserProfile === 'function') {
                    getUserProfile();
                    console.log("Tower Blocks: User profile requested");
                }
                
                // Cache ads with 5 second delay between them
                if (typeof gameCacheAd === 'function') {
                    gameCacheAd();
                    console.log("Tower Blocks: Ads caching started");
                }
            }, 1000);
            
            // Add click listener to start button to lock orientation
            setTimeout(function() {
                const startButton = document.getElementById('start-button');
                const gameContainer = document.getElementById('container');
                const startPauseButton = document.getElementById('start-pause-button');
                
                if (startButton) {
                    // Add click event listener to start button
                    startButton.addEventListener('click', function() {
                        console.log("Tower Blocks: Start button clicked - Locking orientation");
                        if (typeof window.lockGameOrientation === 'function') {
                            window.lockGameOrientation();
                        }
                        // Prevent fullscreen from interfering with game
                        fullscreenAttempted = true;
                        
                        // Hide start button when game starts
                        if (startPauseButton) {
                            startPauseButton.style.display = 'none';
                        }
                    });
                    
                    // Touch event removed to prevent drag notifications
                }
                
                // Also add listener to container for game start (backup)
                if (gameContainer) {
                    gameContainer.addEventListener('click', function(e) {
                        // Check if game-ready is visible (meaning game is starting)
                        const gameReady = document.querySelector('.game-ready');
                        if (gameReady && getComputedStyle(gameReady).display !== 'none') {
                            console.log("Tower Blocks: Game starting - Locking orientation");
                            if (typeof window.lockGameOrientation === 'function') {
                                window.lockGameOrientation();
                            }
                            
                            // Hide start button when game starts
                            if (startPauseButton) {
                                startPauseButton.style.display = 'none';
                            }
                        }
                    });
                }
                
                // Monitor game state changes to show/hide button
                if (gameContainer && startPauseButton) {
                    const observer = new MutationObserver(function(mutations) {
                        mutations.forEach(function(mutation) {
                            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                                const isReady = gameContainer.classList.contains('ready');
                                const isEnded = gameContainer.classList.contains('ended');
                                
                                if (isReady) {
                                    // Game is ready, show start button
                                    startPauseButton.style.display = 'flex';
                                } else if (isEnded) {
                                    // Game ended, show start button again
                                    startPauseButton.style.display = 'flex';
                                }
                            }
                        });
                    });
                    observer.observe(gameContainer, { attributes: true });
                }
            }, 100); // Small delay to ensure DOM is ready
        });
    </script>
    <script  src="app.js?v=22" async></script>
<div id="rotate-text">Rotate your phone</div>
<div id="container">
	<div id="game"></div>
	<div id="score">0</div>
	<div id="instructions"></div>
	<div class="game-over">
		<div class="game-over-content">
			<h2>Game Over</h2>
			<div class="final-score-display">
				<span class="score-label">Final Score</span>
				<span id="final-score" class="score-number">0</span>
			</div>
			<p class="congrats-text">Great job! You're amazing!</p>
			<p class="restart-text">Touch to play again</p>
		</div>
	</div>
                <div class="game-ready">
                    <div class="how-to-play">
                        <h3>üéÆ How to Play</h3>
                        <div class="instruction-item">
                            <span class="icon">üëÜ</span>
                            <p>Tap the screen to place your block</p>
                        </div>
                        <div class="instruction-item">
                            <span class="icon">üì±</span>
                            <p>Keep your device in landscape mode</p>
                        </div>
                        <div class="instruction-item">
                            <span class="icon">üèóÔ∏è</span>
                            <p>Stack blocks as high as you can!</p>
                        </div>
                        <div class="instruction-item">
                            <span class="icon">üéØ</span>
                            <p>Try to beat your high score!</p>
                        </div>
                    </div>
                </div>
	<!-- Exit button -->
	<div id="exit-button" onclick="exitToMainMenu()">‚úï</div>
                <!-- Fullscreen button -->
                <div id="fullscreen-icon" onclick="toggleFullscreenOnly()">‚õ∂</div>
                <!-- Start button -->
                <div id="start-pause-button" onclick="toggleGamePause()">START</div>
</div>
<footer>Tower Blocks 2025</footer>
<script>
function exitToMainMenu() {
    console.log("Tower Blocks: Exit button clicked");
    
    if (window.parent && window.parent !== window) {
        // If in iframe, try to communicate with parent
        console.log("Tower Blocks: Sending exit message to parent");
        window.parent.postMessage('exitGame', '*');
    } else {
        // If standalone, close the game
        console.log("Tower Blocks: Closing game");
        if (confirm('Are you sure you want to exit the game?')) {
            window.close();
            // Fallback for browsers that don't allow window.close()
            setTimeout(function() {
                window.location.href = 'about:blank';
            }, 100);
        }
    }
}

// Global variable to track game state (already declared above)

function toggleGamePause() {
    console.log("Tower Blocks: Start button clicked");
    
    const button = document.getElementById('start-pause-button');
    const container = document.getElementById('container');
    
    // Check if game is in ready state
    const isReady = container.classList.contains('ready');
    
    if (isReady) {
        // Game is ready to start, start the game
        console.log("Tower Blocks: Starting game from button");
        // Trigger the game start by clicking the start button
        const startButton = document.getElementById('start-button');
        if (startButton) {
            startButton.click();
        }
        
        // Hide the start button after clicking
        button.style.display = 'none';
    }
}


// Global variable to track fullscreen state
let isFullscreenActive = false;
let fullscreenAttempted = false;
let dragStartY = 0;
let dragStartTime = 0;


            function addDoubleTapFullscreen() {
                console.log("Tower Blocks: Adding double-tap fullscreen for game streaming");
                
                let tapCount = 0;
                let tapTimer = null;
                
                // Double-tap detection for fullscreen
                document.addEventListener('touchend', function(e) {
                    if (isFullscreenActive) return;
                    
                    tapCount++;
                    console.log("Tower Blocks: Tap count:", tapCount);
                    
                    if (tapCount === 1) {
                        tapTimer = setTimeout(function() {
                            tapCount = 0;
                        }, 1000);
                    } else if (tapCount === 2) {
                        clearTimeout(tapTimer);
                        tapCount = 0;
                        console.log("Tower Blocks: Double tap detected! Going fullscreen...");
                        toggleFullscreen();
                    }
                }, { passive: true });
            }


            function addSmartphoneLandscapeLogic() {
                console.log("Tower Blocks: Adding smartphone landscape mode logic");
                
                // Check if we're in landscape mode on smartphone
                function isSmartphoneLandscape() {
                    return window.matchMedia("(orientation: landscape)").matches && 
                           window.innerWidth <= 1024 && 
                           /Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                }
                
                if (isSmartphoneLandscape()) {
                    console.log("Tower Blocks: Smartphone landscape mode detected");
                    
                    // Auto fullscreen in landscape mode
                    setTimeout(function() {
                        console.log("Tower Blocks: Auto fullscreen in landscape mode");
                        toggleFullscreen();
                    }, 1000);
                    
                    // Modify touch events on game area for landscape mode
                    const gameContainer = document.getElementById('container');
                    if (gameContainer) {
                        // Allow touch events but show instruction to use box icon
                        gameContainer.addEventListener('touchstart', function(e) {
                            console.log("Tower Blocks: Touch detected on game area in landscape mode - use box icon instead");
                            // Don't prevent default, just log
                        }, { passive: true });
                        
                        gameContainer.addEventListener('touchend', function(e) {
                            console.log("Tower Blocks: Touch end detected on game area in landscape mode - use box icon instead");
                            // Don't prevent default, just log
                        }, { passive: true });
                    }
                    
                }
            }


            function toggleFullscreen() {
                console.log("Tower Blocks: Toggle fullscreen called");
                
                // Check if currently in fullscreen
                const isCurrentlyFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);
                
                if (isCurrentlyFullscreen) {
                    // Exit fullscreen
                    console.log("Tower Blocks: Exiting fullscreen");
                    isFullscreenActive = false;
                    
                    if (document.exitFullscreen) {
                        document.exitFullscreen().catch(err => {
                            console.log("Tower Blocks: Exit fullscreen failed:", err);
                        });
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                } else {
                    // Enter fullscreen
                    console.log("Tower Blocks: Entering fullscreen");
                    isFullscreenActive = true;
                    fullscreenAttempted = true;
                    
                    // Try multiple methods for different browsers
                    const fullscreenMethods = [
                        () => document.documentElement.requestFullscreen(),
                        () => document.documentElement.webkitRequestFullscreen(),
                        () => document.documentElement.mozRequestFullScreen(),
                        () => document.documentElement.msRequestFullscreen(),
                        () => document.body.requestFullscreen(),
                        () => document.body.webkitRequestFullscreen()
                    ];
                    
                    let methodIndex = 0;
                    const tryNextMethod = () => {
                        if (methodIndex < fullscreenMethods.length) {
                            try {
                                fullscreenMethods[methodIndex]().catch(err => {
                                    console.log("Tower Blocks: Fullscreen method", methodIndex, "failed:", err);
                                    methodIndex++;
                                    setTimeout(tryNextMethod, 100);
                                });
                            } catch (err) {
                                console.log("Tower Blocks: Fullscreen method", methodIndex, "error:", err);
                                methodIndex++;
                                setTimeout(tryNextMethod, 100);
                            }
                        }
                    };
                    
                    tryNextMethod();
                    
                    // Hide address bar on mobile - multiple attempts
                    setTimeout(function() {
                        window.scrollTo(0, 1);
                    }, 100);
                    
                    setTimeout(function() {
                        window.scrollTo(0, 1);
                    }, 500);
                    
                    setTimeout(function() {
                        window.scrollTo(0, 1);
                    }, 1000);
                    
                    // Force hide browser UI
                    setTimeout(function() {
                        if (window.navigator && window.navigator.standalone !== true) {
                            window.scrollTo(0, 1);
                        }
                    }, 2000);
                }
            }

            function toggleFullscreenOnly() {
                console.log("Tower Blocks: Toggle fullscreen ONLY called - no game start");
                
                // Prevent event propagation to stop game from starting
                event.stopPropagation();
                event.preventDefault();
                
                // Check if currently in fullscreen
                const isCurrentlyFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement);
                
                if (isCurrentlyFullscreen) {
                    // Exit fullscreen
                    console.log("Tower Blocks: Exiting fullscreen (fullscreen only)");
                    isFullscreenActive = false;
                    
                    if (document.exitFullscreen) {
                        document.exitFullscreen().catch(err => {
                            console.log("Tower Blocks: Exit fullscreen failed:", err);
                        });
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                } else {
                    // Enter fullscreen
                    console.log("Tower Blocks: Entering fullscreen (fullscreen only)");
                    isFullscreenActive = true;
                    fullscreenAttempted = true;
                    
                    // Try multiple methods for different browsers
                    const fullscreenMethods = [
                        () => document.documentElement.requestFullscreen(),
                        () => document.documentElement.webkitRequestFullscreen(),
                        () => document.documentElement.mozRequestFullScreen(),
                        () => document.documentElement.msRequestFullscreen(),
                        () => document.body.requestFullscreen(),
                        () => document.body.webkitRequestFullscreen()
                    ];
                    
                    let methodIndex = 0;
                    const tryNextMethod = () => {
                        if (methodIndex < fullscreenMethods.length) {
                            try {
                                fullscreenMethods[methodIndex]().catch(err => {
                                    console.log("Tower Blocks: Fullscreen method", methodIndex, "failed:", err);
                                    methodIndex++;
                                    setTimeout(tryNextMethod, 100);
                                });
                            } catch (err) {
                                console.log("Tower Blocks: Fullscreen method", methodIndex, "error:", err);
                                methodIndex++;
                                setTimeout(tryNextMethod, 100);
                            }
                        }
                    };
                    
                    tryNextMethod();
                    
                    // Hide address bar on mobile - multiple attempts
                    setTimeout(function() {
                        window.scrollTo(0, 1);
                    }, 100);
                    
                    setTimeout(function() {
                        window.scrollTo(0, 1);
                    }, 500);
                    
                    setTimeout(function() {
                        window.scrollTo(0, 1);
                    }, 1000);
                    
                    // Force hide browser UI
                    setTimeout(function() {
                        if (window.navigator && window.navigator.standalone !== true) {
                            window.scrollTo(0, 1);
                        }
                    }, 2000);
                }
            }

            // Enhanced fullscreen function for mobile
            function forceFullscreen() {
                console.log("Tower Blocks: Force fullscreen called");
                
                // Try to enter fullscreen
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log("Tower Blocks: requestFullscreen failed:", err);
                    });
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.mozRequestFullScreen) {
                    document.documentElement.mozRequestFullScreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                }
                
                // Force hide address bar
                setTimeout(function() {
                    window.scrollTo(0, 1);
                }, 100);
                
                setTimeout(function() {
                    window.scrollTo(0, 1);
                }, 500);
                
                setTimeout(function() {
                    window.scrollTo(0, 1);
                }, 1000);
                
                // Additional mobile fullscreen attempts
                setTimeout(function() {
                    if (screen.orientation) {
                        screen.orientation.lock('landscape').catch(err => {
                            console.log("Tower Blocks: Orientation lock failed:", err);
                        });
                    }
                }, 2000);
            }

</script>
</body>
</html>

